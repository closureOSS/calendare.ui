<a9-navigate-back-button></a9-navigate-back-button>
<form [formGroup]="form" (ngSubmit)="submitForm()" *transloco="let t">
  <mat-card>
    <mat-card-header>
      <div mat-card-avatar class="card-icon">
        <cal-icon-principal-type [type]="principal.value()?.principalType?.label"></cal-icon-principal-type>
      </div>
      <mat-card-title>{{principal.value()?.username}} &ndash; {{principal.value()?.displayName}}</mat-card-title>
      <mat-card-subtitle>{{principal.value()?.principalType?.name}}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="a9-form">

        <mat-form-field>
          <mat-label>{{ t('Full name') }}</mat-label>
          <input matInput formControlName="displayName" type="text" [placeholder]="t('Full name of principal')">
        </mat-form-field>

        <mat-form-field>
          <mat-label>{{ t('Timezone') }}</mat-label>
          <input matInput formControlName="timezone" #timezoneinput type="text" [placeholder]="t('Timezone')"
            [matAutocomplete]="timezonelist" (input)="filterTimezones()" (focus)="filterTimezones()">
          <mat-autocomplete requireSelection #timezonelist="matAutocomplete">
            @for(tz of filteredOptions; track tz){ <mat-option [value]="tz">{{tz}}</mat-option> }
          </mat-autocomplete>
          <mat-hint>{{ t('Your current timezone, i.e. Asia/Bangkok, Europe/Berlin, ...') }}</mat-hint>
        </mat-form-field>

        <mat-form-field>
          <mat-label>{{ t('Color') }}</mat-label>
          <input matInput formControlName="color" type="color" colorspace="limited-srgb"
            [placeholder]="t('Color identifier')">
          <mat-hint>{{ t('Usage depends on client; format #rrggbbaa') }}</mat-hint>
        </mat-form-field>

        <mat-form-field>
          <mat-label>{{ t('Description') }}</mat-label>
          <textarea matInput formControlName="description" [placeholder]="t('Description')"></textarea>
        </mat-form-field>

        <mat-form-field>
          <mat-label>{{ t('Main e-mail address') }}</mat-label>
          <input matInput formControlName="email" type="text" [placeholder]="t('Main e-mail address')">
        </mat-form-field>

        @if(formMessage()){
        <a9-hint-box class="a9-form-msg" mode="error" [slim]="true">{{formMessage()}}</a9-hint-box>
        }
      </div>
    </mat-card-content>
    <mat-card-actions>
      <a9-action-bar>
        <button matButton="filled" type="submit">{{ t('Save') }}</button>
        <button matIconButton type="reset" (click)="refresh()" [title]="t('Reset')"><mat-icon svgIcon="restart_alt"></mat-icon></button>
        <!-- <button matButton type="reset"
          [routerLink]="['/principal', 'show', principal.value()?.username]">Cancel</button> -->
      </a9-action-bar>
    </mat-card-actions>
  </mat-card>
</form>

<!-- <pre class="debug">{{principal()|json}}</pre> -->
